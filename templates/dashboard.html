<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Bot Dashboard</title>
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/custom.css">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 d-md-block bg-body-tertiary sidebar collapse">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item mb-2">
                            <a class="nav-link active" href="#">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home">
                                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                                </svg>
                                Dashboard
                            </a>
                        </li>
                        <li class="nav-item mb-2">
                            <a class="nav-link" href="#trades">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-shopping-cart">
                                    <circle cx="9" cy="21" r="1"></circle>
                                    <circle cx="20" cy="21" r="1"></circle>
                                    <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                                </svg>
                                Trades
                            </a>
                        </li>
                        <li class="nav-item mb-2">
                            <a class="nav-link" href="#config">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-settings">
                                    <circle cx="12" cy="12" r="3"></circle>
                                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                                </svg>
                                Configuration
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Main content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Trading Bot Dashboard</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <div class="btn-group me-2">
                            <button type="button" class="btn btn-sm btn-outline-secondary" id="refreshBtn">Refresh</button>
                        </div>
                    </div>
                </div>

                <!-- Overview Cards -->
                <div class="row mb-4">
                    <div class="col-md-3 mb-3">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Symbol</h5>
                                <p class="card-text fs-4">{{ config.get('symbol', 'Not set') }}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Exchange</h5>
                                <p class="card-text fs-4">{{ config.get('exchange', 'Not set') }}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Active Positions</h5>
                                <p class="card-text fs-4">{{ state.get('positions', {})|length }}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Last Update</h5>
                                <p class="card-text">{{ last_update }}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Performance Chart -->
                <div class="row mb-4">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                Performance
                            </div>
                            <div class="card-body">
                                <canvas id="performanceChart" height="250"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Active Positions -->
                <h2 id="positions" class="mt-4 mb-3">Active Positions</h2>
                <div class="table-responsive mb-4">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Symbol</th>
                                <th>Side</th>
                                <th>Amount</th>
                                <th>Entry Price</th>
                                <th>Current PnL</th>
                                <th>Liquidation Price</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if state.get('positions')|length > 0 %}
                                {% for symbol, position in state.get('positions', {}).items() %}
                                <tr>
                                    <td>{{ symbol }}</td>
                                    <td>
                                        {% if position.side == 'long' %}
                                        <span class="badge bg-success">LONG</span>
                                        {% else %}
                                        <span class="badge bg-danger">SHORT</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ position.amount }}</td>
                                    <td>{{ position.entry_price }}</td>
                                    <td>{{ position.pnl }}</td>
                                    <td>{{ position.liquidation_price }}</td>
                                </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="6" class="text-center">No active positions</td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>

                <!-- Trade History -->
                <h2 id="trades" class="mt-4 mb-3">Trade History</h2>
                <div class="table-responsive mb-4">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Date/Time</th>
                                <th>Symbol</th>
                                <th>Side</th>
                                <th>Amount</th>
                                <th>Entry Price</th>
                                <th>Exit Price</th>
                                <th>PnL</th>
                                <th>PnL %</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if state.get('trades')|length > 0 %}
                                {% for trade in state.get('trades', []) %}
                                <tr>
                                    <td>{{ trade.get('time', '') }}</td>
                                    <td>{{ trade.symbol }}</td>
                                    <td>
                                        {% if trade.entry_side == 'long' %}
                                        <span class="badge bg-success">LONG</span>
                                        {% else %}
                                        <span class="badge bg-danger">SHORT</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ trade.amount }}</td>
                                    <td>{{ trade.entry_price }}</td>
                                    <td>{{ trade.exit_price }}</td>
                                    <td>
                                        {% if trade.pnl > 0 %}
                                        <span class="text-success">{{ trade.pnl }}</span>
                                        {% else %}
                                        <span class="text-danger">{{ trade.pnl }}</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if trade.pnl_pct > 0 %}
                                        <span class="text-success">{{ trade.pnl_pct }}%</span>
                                        {% else %}
                                        <span class="text-danger">{{ trade.pnl_pct }}%</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="8" class="text-center">No trade history</td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>

                <!-- Configuration -->
                <h2 id="config" class="mt-4 mb-3">Configuration</h2>
                <div class="card mb-4">
                    <div class="card-header">
                        Trading Parameters
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h5>Basic Settings</h5>
                                <div class="mb-3">
                                    <label for="symbol" class="form-label">Symbol</label>
                                    <input type="text" class="form-control" id="symbol" value="{{ config.get('symbol', '') }}">
                                </div>
                                <div class="mb-3">
                                    <label for="exchange" class="form-label">Exchange</label>
                                    <select class="form-select" id="exchange">
                                        <option value="bybit" {% if config.get('exchange') == 'bybit' %}selected{% endif %}>Bybit</option>
                                        <option value="binance" {% if config.get('exchange') == 'binance' %}selected{% endif %}>Binance</option>
                                        <option value="kucoin" {% if config.get('exchange') == 'kucoin' %}selected{% endif %}>KuCoin</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="timeframe" class="form-label">Timeframe</label>
                                    <select class="form-select" id="timeframe">
                                        <option value="1m" {% if config.get('timeframe') == '1m' %}selected{% endif %}>1 minute</option>
                                        <option value="5m" {% if config.get('timeframe') == '5m' %}selected{% endif %}>5 minutes</option>
                                        <option value="15m" {% if config.get('timeframe') == '15m' %}selected{% endif %}>15 minutes</option>
                                        <option value="1h" {% if config.get('timeframe') == '1h' %}selected{% endif %}>1 hour</option>
                                        <option value="4h" {% if config.get('timeframe') == '4h' %}selected{% endif %}>4 hours</option>
                                        <option value="1d" {% if config.get('timeframe') == '1d' %}selected{% endif %}>1 day</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h5>Risk Management</h5>
                                <div class="mb-3">
                                    <label for="position_size" class="form-label">Position Size (%)</label>
                                    <input type="number" class="form-control" id="position_size" value="{{ config.get('risk_management', {}).get('position_size_pct', 1.0) }}" min="0.1" max="100" step="0.1">
                                </div>
                                <div class="mb-3">
                                    <label for="max_risk" class="form-label">Max Risk Per Trade (%)</label>
                                    <input type="number" class="form-control" id="max_risk" value="{{ config.get('risk_management', {}).get('max_risk_per_trade_pct', 1.0) }}" min="0.1" max="10" step="0.1">
                                </div>
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="use_atr_sizing" {% if config.get('risk_management', {}).get('use_atr_position_sizing', True) %}checked{% endif %}>
                                    <label class="form-check-label" for="use_atr_sizing">Use ATR for Position Sizing</label>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-primary mt-3" id="saveConfigBtn">Save Configuration</button>
                    </div>
                </div>

                <!-- Strategy Configuration -->
                <div class="card mb-4">
                    <div class="card-header">
                        Strategy Parameters
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h5>Indicators</h5>
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="rsi_enabled" {% if config.get('strategy', {}).get('indicators', {}).get('rsi', {}).get('enabled', True) %}checked{% endif %}>
                                    <label class="form-check-label" for="rsi_enabled">RSI</label>
                                </div>
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="macd_enabled" {% if config.get('strategy', {}).get('indicators', {}).get('macd', {}).get('enabled', True) %}checked{% endif %}>
                                    <label class="form-check-label" for="macd_enabled">MACD</label>
                                </div>
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="bollinger_enabled" {% if config.get('strategy', {}).get('indicators', {}).get('bollinger_bands', {}).get('enabled', True) %}checked{% endif %}>
                                    <label class="form-check-label" for="bollinger_enabled">Bollinger Bands</label>
                                </div>
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="ema_cross_enabled" {% if config.get('strategy', {}).get('indicators', {}).get('ema_cross', {}).get('enabled', True) %}checked{% endif %}>
                                    <label class="form-check-label" for="ema_cross_enabled">EMA Cross</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h5>Signal Thresholds</h5>
                                <div class="mb-3">
                                    <label for="entry_threshold" class="form-label">Entry Signal Threshold</label>
                                    <input type="number" class="form-control" id="entry_threshold" value="{{ config.get('strategy', {}).get('entry_threshold', 0.5) }}" min="0" max="1" step="0.1">
                                    <div class="form-text">Higher values require stronger signals to enter a trade.</div>
                                </div>
                                <div class="mb-3">
                                    <label for="exit_threshold" class="form-label">Exit Signal Threshold</label>
                                    <input type="number" class="form-control" id="exit_threshold" value="{{ config.get('strategy', {}).get('exit_threshold', 0.3) }}" min="0" max="1" step="0.1">
                                    <div class="form-text">Higher values require stronger signals to exit a trade.</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/static/js/dashboard.js"></script>
</body>
</html>